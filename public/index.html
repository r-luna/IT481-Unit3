<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IT391 Luna Unit6 Part B</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous" />
    <link href="/stylesheets/style.css" rel="stylesheet" />
    <script>
      var textregex = /^[~!@#$%^&*()_+=-`\[\]\\\{\}|\:\;\"\<\>\?\/\.\,]+$/g; 
      var pwdregex = /[\[\]\.\;\']/g;
      var emailregex = /[\w\-\.]{1,}@[\w\.]{1,}.\w{2,3}/g;
      var hasCharacter = /(?=.*[a-zA-Z])/g;
      var hasNumber = /(?=.*[0-9])/g;
      var hasSpecialChar = /(?=.*[!@#$%^&*()_+\-=\[\]{}':"\\|,.\/?])/g;

      var validateName = function(str) {
        var form = getEl('#unit-6');
        var val = form[str].value;
        if (val.length === 0) {
          return { valid: false, name: str, msg: initialCap(str) + ' name is required' };
        } else if (val.length < 2) {
          return { valid: false, name: str, msg: initialCap(str) + ' name requires at least 2 characters' };
        } else if (val.length > 20) {
          return { valid: false, name: str, msg: initialCap(str) + ' name maximum length is 20 characters' };
        } else if (textregex.test(val)) {
          return { valid: false, name: str, msg: initialCap(str) + ' name contains invalid characters' };
        } else {
          return { valid: true, name: str, msg:null };
        }
      }

      var validatePassword = function(str){
        var form = getEl('#unit-6');
        var val = form[str].value;
        if (val.length === 0) {
          return { valid: false, name: str, msg: initialCap(str) + ' is required' };

        } else if (val.length < 12) {
          return { valid: false, name: str, msg: initialCap(str) + ' requires at least 12 characters' };

        } else if (val.length > 20) {
          return { valid: false, name: str, msg: initialCap(str) + ' maximum length is 20 characters' };

        } else if (pwdregex.test(val)) {
          return { valid: false, name: str, msg: initialCap(str) + ' contains invalid characters' };

        } else if (!hasCharacter.test(val)) {
          return { valid: false, name: str, msg: initialCap(str) + ' requires at least 1 letter' };

        } else if (!hasNumber.test(val)) {
          return { valid: false, name: str, msg: initialCap(str) + ' requires at least 1 number' };

        } else if (!hasSpecialChar.test(val)) {
          return { valid: false, name: str, msg: initialCap(str) + ' requires at least 1 special character excluding <, >, ;' };

        } else {
          return { valid: true, name: str, msg: null };

        }
      }

      var pwdAreEqual = function(p1, p2) {
        var pwd1 = validatePassword('password1');
        var pwd2 = validatePassword('password2');
        if (!pwd1.valid || !pwd2.valid) {
          return { valid:true, name: 'password', msg:''}; // just to get passed the validation / ignore this in this condition
        }
        var form = getEl('#unit-6');
        if (form[p1].value !== form[p2].value) {
          return { valid: false, name: 'password', msg: 'Passwords must match' };
        }
        return { valid: true, name: 'password', msg: null };
      }

      var validateEmail = function() {
        var form = getEl('#unit-6');
        var val = form['email'].value;
        if (val.length === 0) {
          return {valid: false, name: 'email', msg: 'Email is required'};

        } else if (val.match(emailregex) === null) {
          return { valid: false, name: 'email', msg: 'Email does not appear to be valid' };

        } else {
          return { valid: true, name: 'email', msg:null };

        }
      }

      var validateGender = function() {
        var val = document.querySelector('input[name="gender"]:checked')?.value;
        if (typeof val !== 'undefined') {
            return { valid: true, name: 'gender', msg: null };
        }
        return { valid: false, name: 'gender', msg: 'Gender is required' };
      }

      var validateDOB = function(str) {
        var form = getEl('#unit-6');
        var val = form[str].options.selectedIndex;
        if (val === 0) {
          return { valid: false, name: str, msg: initialCap(str) + ' is required' };
        }
        return { valid: true, name: str, msg: null };
      }

      var adjustDay = function() {
        var month = document.querySelector('select[name="month"] option:checked').value;
        var day = document.querySelector('select[name="day"]');
        var days = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        var options = '<option value="">Day</option>';
        for (var i = 0; i < days[month -1]; i++) {
          options += '<option value="' + (i + 1) + '">' + (i + 1) + '</option>';
        }
        day.innerHTML = options;
      }

      var initialCap = function(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
      }

      var getEl = function(str) {
        return document.querySelector(str);
      }

      var togglePasswordFieldType = function() {
        var pass1 = document.querySelector('#password1');
        var pass2 = document.querySelector('#password2');
        if (pass1.type === 'password') {
          pass1.type = 'text';
          pass2.type = 'text';
        } else {
          pass1.type = 'password';
          pass2.type = 'password';
        }
      }

      var resetFieldError = function(str) {
        document.querySelector('#' + str + 'Err').innerHTML = '';
      }

      var validate = function(e) {
        e.preventDefault();
        var counter = 0;
        var validated = [];
        validated.push(validateName('first'));
        validated.push(validateName('last'));
        validated.push(validatePassword('password1'));
        validated.push(validatePassword('password2'));
        validated.push(validateEmail());
        validated.push(validateGender());
        validated.push(validateDOB('month'));
        validated.push(validateDOB('day'));
        validated.push(validateDOB('year'));
        validated.push(pwdAreEqual('password1', 'password2'));
        
        for (var i = 0; i < validated.length; i++) {
          if (!validated[i].valid){
            if (validated[i].name === 'password') {
              document.querySelector('#password1Err').innerHTML = '';
              document.querySelector('#password2Err').innerHTML = validated[i].msg;
            } else {
              document.querySelector('#' + validated[i].name + 'Err').innerHTML = validated[i].msg;
            }
          } else {
            counter++;
          }
        }
        if (counter === 10) {
          new bootstrap.Modal(document.getElementById('successModal'), {keyboard: true}).show();
        }
      }
    </script>
  </head>
  <body id="body">
    <!-- SATRT MODAL -->
    <div id="successModal" class="modal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Success</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>The form has been submitted.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- END MODAL -->
    <form id="unit-6" class="form-horizontal"  onsubmit="return validate(event)">
      <div class="container-sm">
        <!-- start content -->
        <div class="row">
          <div class="col-sm-12">
            <p><br></p>
            <h1>IT391 Luna Unit6 Part B</h1>
            <p><br></p>
            <h4>Registration form</h4>
            <p><br></p>
          </div>
        </div>
        <!-- START NAME -->
        <div class="row">
          <div class="col-sm-12" class="section-title">
            <p>Name</p>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-3">
            <div class="form-floating">
              <input type="text" class="form-control" id="firstName" name="first" placeholder="First Name" min="2" max="20" />
              <label for="firstName" class="form-label">First Name</label>
              <div class="err" id="firstErr"></div>
            </div>
          </div>
          <div class="col-sm-3">
            <div class="form-floating">
              <input type="text" class="form-control" id="lastName" name="last" placeholder="Last Name" min="2" max="20" />
              <label for="lastName" class="form-label">Last Name</label>
              <div class="err" id="lastErr"></div>
            </div>
          </div>
          <div class="col-sm-6"><!-- empty --></div>
        </div>
        <!-- START BIRTHDAY -->
        <div class="row row-v-margin">
          <div class="col-sm-12" class="section-title">
            <p>Birthday</p>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-3">
            <select id="month" class="form-select" name="month">
              <option value="">Month</option>
              <option value="1">January</option>
              <option value="2">Febuary</option>
              <option value="3">March</option>
              <option value="4">April</option>
              <option value="5">May</option>
              <option value="6">June</option>
              <option value="7">July</option>
              <option value="8">August</option>
              <option value="9">September</option>
              <option value="10">October</option>
              <option value="11">November</option>
              <option value="12">December</option>
            </select>
            <div class="err" id="monthErr"></div>
          </div>
          <div class="col-sm-3">
            <select id="day" class="form-select" name="day">
              <option value="">Day</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="21">21</option>
              <option value="22">22</option>
              <option value="23">23</option>
              <option value="24">24</option>
              <option value="25">25</option>
              <option value="26">26</option>
              <option value="27">27</option>
              <option value="28">28</option>
              <option value="29">29</option>
              <option value="30">30</option>
              <option value="31">31</option>
            </select>
            <div class="err" id="dayErr"></div>
          </div> 
          <div class="col-sm-3">
            <select id="year" class="form-select" name="year">
              <option value="">Year</option>
              <option value="2011">2011</option>
              <option value="2010">2010</option>
              <option value="2009">2009</option>
              <option value="2008">2008</option>
              <option value="2007">2007</option>
              <option value="2006">2006</option>
              <option value="2005">2005</option>
              <option value="2004">2004</option>
              <option value="2003">2003</option>
              <option value="2002">2002</option>
              <option value="2001">2001</option>
              <option value="2000">2000</option>
              <option value="1999">1999</option>
              <option value="1998">1998</option>
              <option value="1997">1997</option>
              <option value="1996">1996</option>
              <option value="1995">1995</option>
              <option value="1994">1994</option>
              <option value="1993">1993</option>
              <option value="1992">1992</option>
              <option value="1991">1991</option>
              <option value="1990">1990</option>
              <option value="1989">1989</option>
              <option value="1988">1988</option>
              <option value="1987">1987</option>
              <option value="1986">1986</option>
              <option value="1985">1985</option>
              <option value="1984">1984</option>
              <option value="1983">1983</option>
              <option value="1982">1982</option>
              <option value="1981">1981</option>
              <option value="1980">1980</option>
              <option value="1979">1979</option>
              <option value="1978">1978</option>
              <option value="1977">1977</option>
              <option value="1976">1976</option>
              <option value="1975">1975</option>
              <option value="1974">1974</option>
              <option value="1973">1973</option>
              <option value="1972">1972</option>
              <option value="1971">1971</option>
              <option value="1970">1970</option>
              <option value="1969">1969</option>
              <option value="1968">1968</option>
              <option value="1967">1967</option>
              <option value="1966">1966</option>
              <option value="1965">1965</option>
              <option value="1964">1964</option>
              <option value="1963">1963</option>
              <option value="1962">1962</option>
              <option value="1961">1961</option>
              <option value="1960">1960</option>
              <option value="1959">1959</option>
            </select>
            <div class="err" id="yearErr"></div>
          </div>
        </div>
        <!-- START GENDER -->
        <div class="row row-v-margin">
          <div class="col-sm-12">
            <p>
              Gender
              <br><span class="err" id="genderErr"></span>
            </p>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="gender" id="gender1" value="male">
              <label class="form-check-label" for="gender1">
                Male
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="gender" id="gender2" value="female">
              <label class="form-check-label" for="gender2">
                Female
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="gender" id="gender3" value="prefer not to say">
              <label class="form-check-label" for="gender3">
                Prefer not to say
              </label>
            </div>
          </div>
        </div>
        <!-- EMAIL -->
        <div class="row row-v-margin">
          <div class="col-sm-6">
            <div class="form-floating">
              <input type="text" class="form-control" id="email" name="email" placeholder="Email" />
              <label for="email" class="form-label">Email</label>
              <div class="err" id="emailErr"></div>
            </div>
          </div>
        </div>
        <!-- PASSWORD -->
        <div class="row row-v-margin">
          <div class="col-sm-6">
            <div class="form-floating">
              <input type="password" class="form-control" id="password1" name="password1" placeholder="Password" max="20" />
              <label for="password1" class="form-label">Password</label>
              <div class="err" id="password1Err"></div>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="form-floating">
              <input type="password" class="form-control" id="password2" name="password2" placeholder="Verify Password" max="20" />
              <label for="password2" class="form-label">Verify Password</label>
              <div class="err" id="password2Err"></div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <div class="form-check">
              <p><br>
                <input class="form-check-input" type="checkbox" value="" name="showPassword">
                <label class="form-check-label" for="flexCheckDefault">
                  Show Password
                </label>
              </p>
            </div>
          </div>
        </div>
        <!-- SUBMIT -->
        <div class="row row-v-margin">
          <div class="col-sm-12">
            <button class="btn btn-primary" type="submit">Submit</button>
          </div>
        </div>
      </div>
    </form>
    <script>
      var handler = function(e) {
        const name = e.target.name;
        const fieldNames = ['first', 'last','month', 'day','year','gender', 'email', 'password1', 'password2'];
        if (name === 'showPassword') {
          togglePasswordFieldType();
        }
        if (typeof name !== 'undefined') {
          for (var i = 0;i < fieldNames.length; i++) {
            if (name === fieldNames[i]) {
              resetFieldError(name);
              break;
            }
          }
        }
      }
      document.getElementById('body').addEventListener('click', function(e) { handler(e)});
      document.getElementById('body').addEventListener('change  ', function(e) { handler(e)});
      document.getElementById('body').addEventListener('change', function(e) {
        const id = e.target.id;
        if (id === 'month') {
          adjustDay();
        }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
  </body>
</html>